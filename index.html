<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal God-Mode v44</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Rajdhani', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; }
        .god-panel { width: 100%; max-width: 460px; background: #050505; border: 1px solid #1a1a1a; border-radius: 24px; padding: 20px; box-shadow: 0 0 50px rgba(255, 215, 0, 0.05); }
        
        /* Prediction Area */
        .crystal-ball {
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            border: 1px solid #333; border-radius: 20px; padding: 30px; text-align: center; margin-bottom: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            position: relative;
        }
        .prediction-text { font-size: 4.5rem; font-weight: 900; line-height: 1; text-shadow: 0 0 15px rgba(255, 255, 255, 0.1); }
        .jackpot-nums { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .num-circle { width: 45px; height: 45px; border-radius: 10px; border: 1px solid #444; background: #080808; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: bold; color: #FFD700; }
        
        /* Header Info */
        .info-bar { display: flex; justify-content: space-between; align-items: center; background: #111; padding: 10px 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #222; }
        .target-label { font-size: 10px; color: #666; font-weight: bold; letter-spacing: 1px; text-transform: uppercase; }
        .target-value { font-size: 18px; font-weight: bold; color: #fff; }
        .timer-box { font-family: monospace; color: #FFD700; font-weight: bold; font-size: 16px; }

        /* History Table */
        .history-container { background: #080808; border: 1px solid #1a1a1a; border-radius: 15px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { background: #111; color: #555; padding: 8px; text-align: center; font-weight: 800; text-transform: uppercase; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid #1a1a1a; color: #aaa; font-weight: 600; }
        .status-cell { font-size: 14px; }
        
        /* Animations */
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 255, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); } }
        .live-active { animation: pulse-green 2s infinite; border-color: #00ff00; }
    </style>
</head>
<body>

    <div class="god-panel">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-sm font-black text-gray-300 tracking-widest">UNIVERSAL GOD-MODE</h1>
                <div class="flex items-center gap-2 mt-1">
                    <div id="status-dot" class="w-2 h-2 rounded-full bg-yellow-600"></div>
                    <span id="status-text" class="text-[9px] text-gray-500 font-bold uppercase">CONNECTING...</span>
                </div>
            </div>
            <div class="text-right">
                <span class="text-yellow-500 font-black text-xl">Œ©</span>
            </div>
        </div>

        <div class="info-bar" id="info-panel">
            <div>
                <div class="target-label">Next Target Period</div>
                <div class="target-value" id="target-id">#Loading...</div>
            </div>
            <div class="text-right">
                <div class="target-label">Time Remaining</div>
                <div class="timer-box" id="timer">00s</div>
            </div>
        </div>

        <div class="crystal-ball" id="crystal-box">
            <div class="absolute top-3 left-0 w-full text-center">
                <span class="text-[9px] text-gray-600 font-bold uppercase tracking-[4px]">AI NEURAL SIGNAL</span>
            </div>
            
            <h2 id="prediction-text" class="prediction-text text-gray-700">--</h2>
            
            <div class="jackpot-nums">
                <div class="num-circle" id="n1">?</div>
                <div class="num-circle" id="n2" style="border-color: #00f3ff; color: #00f3ff;">?</div>
            </div>
        </div>

        <div class="flex justify-between items-end mb-2 px-1">
            <span class="text-[10px] text-gray-500 font-bold uppercase">Performance Log</span>
            <span class="text-[9px] text-green-500 font-bold" id="win-rate">Accuracy: 0%</span>
        </div>
        
        <div class="history-container">
            <div style="max-height: 250px; overflow-y: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Prediction</th>
                            <th>Result</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION (Set Once, Run Forever) ---
        const TUNNEL_URL = "https://wingo.ahmadalisafdar86.workers.dev/"; 
        const API_KEY = "AIzaSyD8xaD8BynNDJq7X-cKTsfyj14wCakz6JI";
        const WINGO_API = "https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?pageSize=30"; // Increased to 30 for deeper learning

        // --- 2. GLOBAL VARIABLES ---
        let historyData = []; // Local history for UI
        let lastProcessedPeriod = null;
        let stats = { wins: 0, total: 0 };
        let isAIWorking = false;

        // --- 3. THE UNIVERSAL ENGINE ---
        async function runGodMode() {
            try {
                // Fetch Real Data via Tunnel
                const res = await fetch(`${TUNNEL_URL}?url=${encodeURIComponent(WINGO_API + "&ts=" + Date.now())}`);
                const json = await res.json();
                const apiList = json.data.list;
                const latestIssue = apiList[0].issueNumber;

                // LOGIC: Validate Previous Prediction
                if (historyData.length > 0) {
                    const lastEntry = historyData[0];
                    if (lastEntry.status === "WAIT") {
                        // Check if the result for our waiting prediction has arrived
                        const resultData = apiList.find(item => item.issueNumber === lastEntry.period);
                        if (resultData) {
                            finalizeResult(lastEntry, resultData);
                        }
                    }
                }

                // LOGIC: Calculate NEXT Period (Latest + 1)
                const nextPeriod = (BigInt(latestIssue) + 1n).toString();

                // If we haven't predicted for this NEW period yet, DO IT
                if (lastProcessedPeriod !== nextPeriod) {
                    lastProcessedPeriod = nextPeriod;
                    
                    // Update UI for Next Target
                    document.getElementById('target-id').innerText = "#" + nextPeriod.slice(-4);
                    document.getElementById('info-panel').classList.add('live-active');
                    updateStatus("Scanning Patterns...", "yellow");
                    
                    // Call Gemini AI
                    await callUniversalAI(apiList, nextPeriod);
                }

            } catch (err) {
                console.error(err);
                updateStatus("Reconnecting...", "red");
            }
        }

        // --- 4. GEMINI 2.5 FLASH INTEGRATION ---
        async function callUniversalAI(marketHistory, targetPeriod) {
            isAIWorking = true;
            document.getElementById('prediction-text').innerText = "Analyzing...";
            document.getElementById('prediction-text').className = "prediction-text text-gray-500 text-3xl";

            // Universal Prompt - Designed for "Universal" adaptation
            const prompt = `
                You are a Wingo Prediction Engine.
                History (Newest First): ${JSON.stringify(marketHistory.slice(0, 20).map(x => ({issue: x.issueNumber, num: x.totalNumber})))}.
                
                Task: Predict the outcome for the FUTURE period: ${targetPeriod}.
                
                Algorithm Instructions:
                1. Detect current trend (ZigZag, Streak, or Pattern Break).
                2. If last 3 were same, assess probability of Flip vs Streak.
                3. Provide Level 1 Sureshot.
                
                Output JSON ONLY: {"p":"BIG/SMALL","n":[n1,n2]} 
                (n1, n2 are probable numbers 0-9).
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                const rawText = data.candidates[0].content.parts[0].text.replace(/```json|```/g, "").trim();
                const pred = JSON.parse(rawText);

                // Display Result
                displayPrediction(pred);

                // Add to History Table as "Pending"
                addToHistory(targetPeriod, pred);
                
                updateStatus("Target Locked", "green");

            } catch (err) {
                updateStatus("AI Busy", "red");
            } finally {
                isAIWorking = false;
            }
        }

        // --- 5. UI & LOGIC FUNCTIONS ---
        function displayPrediction(data) {
            const el = document.getElementById('prediction-text');
            el.innerText = data.p;
            el.className = `prediction-text ${data.p === 'BIG' ? 'text-green-500' : 'text-red-500'}`;
            
            document.getElementById('n1').innerText = data.n[0];
            document.getElementById('n2').innerText = data.n[1];
        }

        function addToHistory(period, pred) {
            historyData.unshift({
                period: period,
                predType: pred.p,
                predNums: pred.n,
                status: "WAIT",
                resultVal: "?"
            });
            if(historyData.length > 8) historyData.pop();
            renderTable();
        }

        function finalizeResult(entry, actualData) {
            const actualNum = parseInt(actualData.totalNumber);
            const actualSize = actualNum >= 5 ? "BIG" : "SMALL";
            
            const isWin = entry.predType === actualSize;
            const isJackpot = entry.predNums.includes(actualNum);

            // Universal Emoji Logic
            if (isWin && isJackpot) {
                entry.status = "‚úÖ üéâ"; // Double Win
            } else if (isWin) {
                entry.status = "‚úÖ"; // Normal Win
            } else {
                entry.status = "‚ùå"; // Loss
            }

            entry.resultVal = `${actualNum} (${actualSize[0]})`;
            
            // Update Accuracy Stats
            stats.total++;
            if (isWin) stats.wins++;
            const acc = Math.round((stats.wins / stats.total) * 100);
            document.getElementById('win-rate').innerText = `Accuracy: ${acc}%`;

            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('history-body');
            tbody.innerHTML = historyData.map(row => `
                <tr class="border-b border-[#1a1a1a]">
                    <td>#${row.period.slice(-4)}</td>
                    <td class="${row.predType === 'BIG' ? 'text-green-400' : 'text-red-400'} font-bold">${row.predType}</td>
                    <td class="text-yellow-500">${row.resultVal}</td>
                    <td class="status-cell">${row.status === 'WAIT' ? '‚è≥' : row.status}</td>
                </tr>
            `).join('');
        }

        function updateStatus(msg, color) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            text.innerText = msg;
            
            // Tailwind classes dynamic update
            dot.className = `w-2 h-2 rounded-full ${color === 'green' ? 'bg-green-500 shadow-[0_0_10px_#00ff00]' : (color === 'red' ? 'bg-red-500' : 'bg-yellow-500')}`;
            if(color === 'green') document.getElementById('info-panel').style.borderColor = "#00ff00";
            else document.getElementById('info-panel').style.borderColor = "#222";
        }

        // --- 6. TIMER & LOOP ---
        setInterval(() => {
            const d = new Date();
            const s = d.getSeconds();
            const remaining = 60 - s;
            document.getElementById('timer').innerText = remaining < 10 ? `0${remaining}s` : `${remaining}s`;

            // Auto-Refresh Trigger (Smart Sync)
            // Checks at 3 seconds past the minute (gives time for Wingo API to update)
            if (s === 3 && !isAIWorking) {
                runGodMode();
            }
            // Secondary check at 30 seconds for safety
            if (s === 30 && !isAIWorking) {
                runGodMode();
            }

        }, 1000);

        // Initial Run
        runGodMode();

    </script>
</body>
</html>
