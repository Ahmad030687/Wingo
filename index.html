<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singularity v41 | Pro Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 10px; }
        .panel { width: 100%; max-width: 450px; background: #0a0a0a; border: 2px solid #333; border-radius: 20px; padding: 20px; margin: auto; }
        .big-val { font-family: 'Orbitron'; font-size: 5rem; font-weight: 900; line-height: 1; }
        .j-box { width: 60px; height: 60px; background: #111; border: 2px solid #FFD700; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; color: #FFD700; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 15px; }
        th, td { border: 1px solid #222; padding: 8px; text-align: center; }
        th { background: #1a1a1a; color: #777; }
        .win { color: #00ff00; font-weight: bold; }
        .loss { color: #ff0000; font-weight: bold; }
    </style>
</head>
<body>

    <div class="panel">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-xs tracking-[4px] text-gray-500 font-bold uppercase">Singularity v41.0</h1>
                <div class="flex items-center gap-2 mt-1">
                    <span id="ai-dot" class="w-2 h-2 rounded-full bg-red-600"></span>
                    <span id="ai-status" class="text-[10px] text-gray-500 font-bold uppercase">Ready</span>
                </div>
            </div>
            <div class="text-right">
                <span class="text-yellow-500 font-black text-xl">Î©</span>
                <p class="text-[8px] text-gray-600">PRIVATE_TUNNEL</p>
            </div>
        </div>

        <div class="bg-white/5 p-6 rounded-3xl border border-white/5 text-center mb-6">
            <p id="prediction-val" class="big-val text-gray-400">--</p>
            <div class="flex justify-center gap-6 mt-4">
                <div class="j-box" id="n1">?</div>
                <div class="j-box" id="n2" style="border-color:#00f3ff; color:#00f3ff;">?</div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-2 mb-6 text-center">
            <div class="bg-black p-2 rounded-xl border-b-2 border-green-500">
                <p class="text-[9px] text-gray-500">WINS</p>
                <p class="text-lg font-bold" id="total-wins">0</p>
            </div>
            <div class="bg-black p-2 rounded-xl border-b-2 border-red-500">
                <p class="text-[9px] text-gray-500">LOSS</p>
                <p class="text-lg font-bold" id="total-loss">0</p>
            </div>
            <div class="bg-black p-2 rounded-xl border-b-2 border-yellow-500">
                <p class="text-[9px] text-gray-500">JACKPOT</p>
                <p class="text-lg font-bold" id="total-jp">0</p>
            </div>
        </div>

        <div class="flex justify-between items-center px-2 mb-4">
            <span class="text-xs font-bold text-gray-400 uppercase">Target Period: <span id="period-id" class="text-white">#----</span></span>
            <span id="timer" class="text-xs font-mono text-yellow-500">60s</span>
        </div>

        <p class="text-[10px] text-gray-600 font-bold uppercase mb-2">Last 10 Rounds Analysis</p>
        <div class="overflow-hidden rounded-xl border border-[#222]">
            <table>
                <thead>
                    <tr><th>Period</th><th>Prediction</th><th>Numbers</th><th>Result</th></tr>
                </thead>
                <tbody id="history-body">
                    <tr><td colspan="4" class="text-gray-700">Waiting for data pulse...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const TUNNEL = "https://wingo.ahmadalisafdar86.workers.dev/"; 
        const KEY = "AIzaSyB1NnBfAgcsqh7RGs8o_aJFJz7D2ROFgqc";
        const API = "https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?pageSize=20";

        let lastIssue = null;
        let isLocked = false;
        let stats = { w: 0, l: 0, j: 0 };
        let history = [];

        async function syncEngine() {
            if(isLocked) return;
            try {
                const res = await fetch(`${TUNNEL}?url=${encodeURIComponent(API)}`);
                const data = await res.json();
                const latest = data.data.list[0];

                if (lastIssue !== latest.issueNumber) {
                    // Check pichla result logic (simplified)
                    if(lastIssue) analyzeResult(latest, history[0]);
                    
                    lastIssue = latest.issueNumber;
                    document.getElementById('period-id').innerText = "#" + (BigInt(lastIssue) + 1n).toString().slice(-4);
                    await callAI(data.data.list);
                }
            } catch (e) { console.log("Tunnel Wait..."); }
        }

        async function callAI(marketData) {
            isLocked = true; // Rate Limit Protection
            document.getElementById('ai-status').innerText = "LOCKING...";
            
            const url = `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${KEY}`;
            const prompt = `Analyze: ${JSON.stringify(marketData)}. Predict next BIG/SMALL and 2 jackpot numbers. JSON ONLY: {"p":"BIG/SMALL","n":[x,y]}`;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const result = await response.json();
                const pred = JSON.parse(result.candidates[0].content.parts[0].text.replace(/```json|```/g, ""));
                
                updateUI(pred);
                
                // Cooldown for 45 seconds to prevent Rate Limit
                let cd = 45;
                const t = setInterval(() => {
                    document.getElementById('timer').innerText = cd + "s";
                    if(cd <= 0) { clearInterval(t); isLocked = false; document.getElementById('ai-status').innerText = "READY"; }
                    cd--;
                }, 1000);

            } catch (err) {
                isLocked = false;
                document.getElementById('ai-status').innerText = "RETRYING...";
            }
        }

        function updateUI(data) {
            const p = document.getElementById('prediction-val');
            p.innerText = data.p;
            p.className = `big-val ${data.p === 'BIG' ? 'text-green-500' : 'text-red-600'}`;
            document.getElementById('n1').innerText = data.n[0];
            document.getElementById('n2').innerText = data.n[1];
            document.getElementById('ai-dot').className = "w-2 h-2 rounded-full bg-green-500";
            
            // Add to history
            history.unshift({ p: data.p, n: data.n, issue: (BigInt(lastIssue) + 1n).toString().slice(-4) });
            if(history.length > 10) history.pop();
            renderHistory();
        }

        function renderHistory() {
            const body = document.getElementById('history-body');
            body.innerHTML = history.map(h => `
                <tr>
                    <td>${h.issue}</td>
                    <td class="${h.p === 'BIG' ? 'text-green-500' : 'text-red-500'}">${h.p}</td>
                    <td class="text-yellow-500">${h.n.join(',')}</td>
                    <td class="text-gray-500">WAIT</td>
                </tr>
            `).join('');
        }

        // Logic to update Win/Loss after result comes
        function analyzeResult(actual, pred) {
            if(!pred) return;
            const actualSize = actual.totalNumber <= 4 ? "SMALL" : "BIG";
            const row = document.getElementById('history-body').children[0];
            
            if(actualSize === pred.p) {
                stats.w++;
                document.getElementById('total-wins').innerText = stats.w;
            } else {
                stats.l++;
                document.getElementById('total-loss').innerText = stats.l;
            }
            if(pred.n.includes(parseInt(actual.totalNumber))) {
                stats.j++;
                document.getElementById('total-jp').innerText = stats.j;
            }
        }

        setInterval(syncEngine, 2000);
        syncEngine();
    </script>
</body>
</html>

